\subsection{BRKGA implementation}

\subsubsection{Chromosome structure}

For this implementation, the chromosome will encode the order in which the hours are tried to be fulfilled with nurses. The decoder is behaving as a greedy algorithm but with some modification in order to work with the chromosome as you will see at X. Then the chromosome will have as many gens as hours, and every gen will have a value from 0 to 1. This value is the weight that modify the order of the fulfilled hours at the decoder.



\subsubsection{Decoder}

Recapping, the greedy algorithm is based on the idea to bring for every candidate a value that depicts the quality of every of them. This value is provided by the greedy function. For purely greedy algorithms, the candidates are sorted by this value and then the best one (the first one of the list) will be included on the solution. An evolution of greedy is GRASP that is randomizing the pick of a candidate with its RCL. This decoder is following the same idea, but taking as order the one given my the chromosome structure, being this order the priority of hours to fulfill.

This means that the gens are affecting to the position of the hours to fulfill in the assignment phase. Once we have all the hours sorted, the first one is picked. Notice that the decoder is deterministic. The randomness in BRKGA is not in the greedy part but in the generation of mutants.

diversify by excess of assignments per hour

\begin{algorithm}[H]
\KwIn{population, nNurses, hours, demand}
%\Parameter{Some parameter}
\KwOut{population}    

\SetKwData{Left}{left}
\SetKwData{This}{this}
\SetKwData{Up}{up}
\SetKwFunction{Union}{Union}
\SetKwFunction{FindCompress}{FindCompress}

\ForEach{$individual$ $\in$ $population$}{
startingHours $\leftarrow$ computeStartingHours(individual, nNurses, hours, demand) \\
solution $\leftarrow$ assignNurses(startingHours, nNurses, hours, demand) \\
calculateFitness(solution) \\
}
fitness $\leftarrow$ computeObjectiveFunctionCost(solution)\\
$\textbf{return}$ population
\caption{BRKGA Decoder algorithm}\label{alg.mainLoop}
\end{algorithm}

\begin{algorithm}[H]
\KwIn{individual, nNurses, hours, demand}
%\Parameter{Some parameter}
\KwOut{startingHours}    

\SetKwData{Left}{left}
\SetKwData{This}{this}
\SetKwData{Up}{up}
\SetKwFunction{Union}{Union}
\SetKwFunction{FindCompress}{FindCompress}
startingHours $\leftarrow$ $\emptyset$ \\
\ForEach{$<gene, index>$ $\in$ $getChromosome(individual)$}{
range $\leftarrow$ $demand_{index}$ \\
startingHour $\leftarrow$ 0 \\
\If{gene $<$ 0.2}{\label{lt}
range $\leftarrow$ $\ceil*{0.8 \times nNurses}$ \\
startingHour $\leftarrow$ $(int)$(range $\times$ gene) \\ 
}
startingHours.add(startingHour) \\
}
$\textbf{return}$ startingHours
\caption{computeStartingHours}\label{alg.mainLoop}
\end{algorithm}



\pagebreak